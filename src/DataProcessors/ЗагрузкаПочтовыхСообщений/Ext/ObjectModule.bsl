
// Функция создает новый объект Документ.ЭлектронноеПисьмо и заполняет
// его данными из объекта ИнтернетПочтовоеСособщение, только без аттачей
//
// Параметры
//  ИнтернетПисьмо - ИнтернетПочтовоеСообщение
//  УчетнаяЗапись - СправочникСсылка.УчетныеЗаписи, учетная запись письма
//  ТекущийПользователь - СправочникСсылка.Пользователи
//  мРазделительАдресов - Строка, разделитель адресов
//  ИсключениеТранзакции - булево, флаг ошибки
//
// Возвращаемое значение:
//   ДокументОбъект.ЭлектронноеПисьмо
//
Функция ПолучитьДокументОбъект(СтрокаТаблицы) Экспорт

	Если СтрокаТаблицы = Неопределено Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Письмо = Документы.ЭлектронноеПисьмо.СоздатьДокумент();
	
	Письмо.УчетнаяЗапись = УчетнаяЗапись;
	
	Письмо.НеРассмотрено = Истина;
	
	Если СтрокаТаблицы.ОтправительАдресЭлектроннойПочты = УчетнаяЗапись.АдресЭлектроннойПочты Тогда
		Письмо.ГруппаУчетнойЗаписи = УчетнаяЗапись.ГруппаИсходящие;
		Письмо.СтатусПисьма = Перечисления.СтатусыПисем.Отправленное;
	Иначе
		Письмо.ГруппаУчетнойЗаписи = УчетнаяЗапись.ГруппаВходящие;
		Письмо.СтатусПисьма = Перечисления.СтатусыПисем.Полученное;
	КонецЕсли;
	
	Письмо.КомуПредставление                = СтрокаТаблицы.КомуПредставление;
	Письмо.Кому                             = СтрокаТаблицы.Кому;
	Письмо.ОтправительИмя                   = СтрокаТаблицы.ОтправительИмя;
	Письмо.ОтправительАдресЭлектроннойПочты = СтрокаТаблицы.ОтправительАдресЭлектроннойПочты;
	Письмо.ОтправительПредставление         = СтрокаТаблицы.ОтправительПредставление;
	Письмо.КопииПредставление               = СтрокаТаблицы.КопииПредставление;
	Письмо.Копии                            = СтрокаТаблицы.Копии;
	
	Письмо.КомуТЧ.Загрузить(СтрокаТаблицы.КомуТЧ.Скопировать());
	Письмо.КопииТЧ.Загрузить(СтрокаТаблицы.КопииТЧ.Скопировать());
	
	Письмо.Тема = СтрокаТаблицы.Тема;
	
	Письмо.Дата            = ТекущаяДата();
	Письмо.ДатаОтправления = СтрокаТаблицы.ДатаПолучения;
	Письмо.ДатаТранспорта  = СтрокаТаблицы.ДатаПолучения;
	
	Письмо.ВидТекстаПисьма = Перечисления.ВидыТекстовЭлектронныхПисем.Текст;
	Письмо.ТекстПисьма = СтрокаТаблицы.ПочтовоеСообщение.Текст;
	Письмо.НеРассмотрено = Истина;
	
	Письмо.ЕстьВложения = СтрокаТаблицы.Вложения;
	
	УправлениеЭлектроннойПочтой.НайтиИПроставитьОснованиеПисьма(Письмо);
	
	Если Письмо.Предмет = Неопределено Тогда
		Письмо.Предмет = "";
	КонецЕсли; 
	
	Возврат Письмо;
	
КонецФункции
